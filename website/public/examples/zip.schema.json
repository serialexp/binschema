{
  "meta": {
    "title": "ZIP Archive Format",
    "version": "PKWARE APPNOTE",
    "description": "ZIP archive file format with local file headers, central directory, and end-of-central-directory record. Supports computed CRCs and file offsets."
  },
  "config": {
    "endianness": "little_endian"
  },
  "types": {
    "LocalFileHeader": {
      "sequence": [
        { "name": "version", "type": "uint16" },
        { "name": "flags", "type": "uint16" },
        { "name": "compression_method", "type": "uint16" },
        { "name": "file_mod_time", "type": "uint16" },
        { "name": "file_mod_date", "type": "uint16" },
        {
          "name": "crc32",
          "type": "uint32",
          "computed": {
            "type": "crc32_of",
            "target": "../body"
          }
        },
        {
          "name": "len_body_compressed",
          "type": "uint32",
          "computed": {
            "type": "length_of",
            "target": "../body"
          }
        },
        {
          "name": "len_body_uncompressed",
          "type": "uint32",
          "computed": {
            "type": "length_of",
            "target": "../body"
          }
        },
        {
          "name": "len_file_name",
          "type": "uint16",
          "computed": {
            "type": "length_of",
            "target": "file_name",
            "encoding": "utf8"
          }
        },
        { "name": "len_extra", "type": "uint16" },
        {
          "name": "file_name",
          "type": "string",
          "kind": "field_referenced",
          "length_field": "len_file_name",
          "encoding": "utf8"
        }
      ]
    },
    "LocalFile": {
      "sequence": [
        { "name": "signature", "type": "uint32", "const": 67324752 },
        { "name": "header", "type": "LocalFileHeader" },
        {
          "name": "body",
          "type": "array",
          "kind": "field_referenced",
          "length_field": "header.len_body_compressed",
          "items": { "type": "uint8" }
        }
      ]
    },
    "CentralDirEntry": {
      "sequence": [
        { "name": "signature", "type": "uint32", "const": 33639248 },
        { "name": "version_made_by", "type": "uint16" },
        { "name": "version_needed", "type": "uint16" },
        { "name": "flags", "type": "uint16" },
        { "name": "compression_method", "type": "uint16" },
        { "name": "file_mod_time", "type": "uint16" },
        { "name": "file_mod_date", "type": "uint16" },
        {
          "name": "crc32",
          "type": "uint32",
          "computed": {
            "type": "crc32_of",
            "target": "../sections[corresponding<LocalFile>].body"
          }
        },
        {
          "name": "len_body_compressed",
          "type": "uint32",
          "computed": {
            "type": "length_of",
            "target": "../sections[corresponding<LocalFile>].body"
          }
        },
        {
          "name": "len_body_uncompressed",
          "type": "uint32",
          "computed": {
            "type": "length_of",
            "target": "../sections[corresponding<LocalFile>].body"
          }
        },
        {
          "name": "len_file_name",
          "type": "uint16",
          "computed": {
            "type": "length_of",
            "target": "file_name",
            "encoding": "utf8"
          }
        },
        { "name": "len_extra", "type": "uint16" },
        { "name": "len_comment", "type": "uint16" },
        { "name": "disk_number_start", "type": "uint16" },
        { "name": "int_file_attr", "type": "uint16" },
        { "name": "ext_file_attr", "type": "uint32" },
        {
          "name": "ofs_local_header",
          "type": "uint32",
          "computed": {
            "type": "position_of",
            "target": "../sections[corresponding<LocalFile>]"
          }
        },
        {
          "name": "file_name",
          "type": "string",
          "kind": "field_referenced",
          "length_field": "len_file_name",
          "encoding": "utf8"
        }
      ]
    },
    "EndOfCentralDir": {
      "sequence": [
        { "name": "signature", "type": "uint32", "const": 101010256 },
        { "name": "disk_number", "type": "uint16" },
        { "name": "disk_with_central_dir", "type": "uint16" },
        { "name": "num_entries_this_disk", "type": "uint16" },
        { "name": "num_entries_total", "type": "uint16" },
        {
          "name": "len_central_dir",
          "type": "uint32",
          "computed": {
            "type": "sum_of_type_sizes",
            "target": "../sections",
            "element_type": "CentralDirEntry"
          }
        },
        {
          "name": "ofs_central_dir",
          "type": "uint32",
          "computed": {
            "type": "position_of",
            "target": "../sections[first<CentralDirEntry>]"
          }
        },
        { "name": "len_comment", "type": "uint16" }
      ]
    },
    "ZipArchive": {
      "sequence": [
        {
          "name": "sections",
          "type": "array",
          "kind": "fixed",
          "length": 3,
          "items": {
            "type": "choice",
            "choices": [
              { "type": "LocalFile" },
              { "type": "CentralDirEntry" },
              { "type": "EndOfCentralDir" }
            ]
          }
        }
      ]
    }
  }
}

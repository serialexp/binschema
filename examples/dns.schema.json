{
  "config": {
    "endianness": "big_endian"
  },
  "types": {
    "DNSHeader": {
      "description": "DNS message header - fixed 12 bytes at start of all DNS messages",
      "sequence": [
        { "name": "id", "type": "uint16" },
        { "name": "qr", "type": "bit", "size": 1 },
        { "name": "opcode", "type": "bit", "size": 4 },
        { "name": "aa", "type": "bit", "size": 1 },
        { "name": "tc", "type": "bit", "size": 1 },
        { "name": "rd", "type": "bit", "size": 1 },
        { "name": "ra", "type": "bit", "size": 1 },
        { "name": "z", "type": "bit", "size": 3 },
        { "name": "rcode", "type": "bit", "size": 4 },
        { "name": "qdcount", "type": "uint16" },
        { "name": "ancount", "type": "uint16" },
        { "name": "nscount", "type": "uint16" },
        { "name": "arcount", "type": "uint16" }
      ]
    },
    "Label": {
      "description": "Single DNS label - length byte (0-63) followed by that many ASCII characters",
      "type": "string",
      "kind": "length_prefixed",
      "length_type": "uint8",
      "encoding": "ascii"
    },
    "DomainName": {
      "description": "Complete domain name - sequence of labels terminated by zero-length label",
      "type": "array",
      "kind": "null_terminated",
      "items": { "type": "Label" }
    },
    "Pointer": {
      "description": "DNS compression pointer - 2 bytes where top 2 bits are 11, followed by 14-bit offset from start of DNS message",
      "type": "uint16",
      "notes": [
        "Format: 11OOOOOO OOOOOOOO (where O = offset bits)",
        "Value is always >= 0xC000 (49152 decimal)",
        "Offset points to start of domain name elsewhere in message",
        "Allows message compression by eliminating repeated domain names"
      ]
    },
    "Question": {
      "description": "Question section entry - what is being asked",
      "sequence": [
        {
          "name": "qname",
          "type": "DomainName",
          "variants": ["DomainName", "Pointer"],
          "notes": ["Can be a full domain name OR a compression pointer"]
        },
        { "name": "qtype", "type": "uint16" },
        { "name": "qclass", "type": "uint16" }
      ]
    },
    "ResourceRecord": {
      "description": "Resource record - answer/authority/additional section entry",
      "sequence": [
        {
          "name": "name",
          "type": "DomainName",
          "variants": ["DomainName", "Pointer"],
          "notes": ["Can be a full domain name OR a compression pointer (most commonly compressed)"]
        },
        { "name": "rtype", "type": "uint16" },
        { "name": "rclass", "type": "uint16" },
        { "name": "ttl", "type": "uint32" },
        { "name": "rdlength", "type": "uint16" },
        {
          "name": "rdata",
          "type": "array",
          "kind": "length_prefixed",
          "length_type": "uint16",
          "length_field": "rdlength",
          "items": { "type": "uint8" },
          "variants": ["A_Record", "NS_Record", "CNAME_Record", "SOA_Record", "PTR_Record", "MX_Record", "TXT_Record", "AAAA_Record"],
          "notes": [
            "Format depends on TYPE field:",
            "1=A_Record (IPv4 address)",
            "2=NS_Record (authoritative name server)",
            "5=CNAME_Record (canonical name)",
            "6=SOA_Record (start of authority)",
            "12=PTR_Record (domain name pointer)",
            "15=MX_Record (mail exchange)",
            "16=TXT_Record (text strings)",
            "28=AAAA_Record (IPv6 address)"
          ]
        }
      ]
    },
    "A_Record": {
      "description": "A record RDATA - IPv4 address (TYPE=1, CLASS=IN)",
      "sequence": [
        { "name": "address", "type": "uint32" }
      ]
    },
    "NS_Record": {
      "description": "NS record RDATA - authoritative name server (TYPE=2)",
      "sequence": [
        {
          "name": "nsdname",
          "type": "DomainName",
          "variants": ["DomainName", "Pointer"],
          "notes": ["Name server domain name - can be compressed"]
        }
      ]
    },
    "CNAME_Record": {
      "description": "CNAME record RDATA - canonical name for an alias (TYPE=5)",
      "sequence": [
        {
          "name": "cname",
          "type": "DomainName",
          "variants": ["DomainName", "Pointer"],
          "notes": ["Canonical domain name - can be compressed"]
        }
      ]
    },
    "SOA_Record": {
      "description": "SOA record RDATA - start of authority (TYPE=6)",
      "sequence": [
        {
          "name": "mname",
          "type": "DomainName",
          "variants": ["DomainName", "Pointer"],
          "notes": ["Primary name server - can be compressed"]
        },
        {
          "name": "rname",
          "type": "DomainName",
          "variants": ["DomainName", "Pointer"],
          "notes": ["Responsible mailbox - can be compressed"]
        },
        { "name": "serial", "type": "uint32" },
        { "name": "refresh", "type": "uint32" },
        { "name": "retry", "type": "uint32" },
        { "name": "expire", "type": "uint32" },
        { "name": "minimum", "type": "uint32" }
      ]
    },
    "PTR_Record": {
      "description": "PTR record RDATA - pointer to domain name (TYPE=12)",
      "sequence": [
        {
          "name": "ptrdname",
          "type": "DomainName",
          "variants": ["DomainName", "Pointer"],
          "notes": ["Domain name pointer - can be compressed"]
        }
      ]
    },
    "MX_Record": {
      "description": "MX record RDATA - mail exchange (TYPE=15)",
      "sequence": [
        { "name": "preference", "type": "uint16" },
        {
          "name": "exchange",
          "type": "DomainName",
          "variants": ["DomainName", "Pointer"],
          "notes": ["Mail exchange domain name - can be compressed"]
        }
      ]
    },
    "TXT_Record": {
      "description": "TXT record RDATA - text strings (TYPE=16)",
      "type": "array",
      "kind": "length_prefixed",
      "length_type": "uint8",
      "items": { "type": "uint8" },
      "notes": [
        "One or more character-strings",
        "Each string is length-prefixed (1 byte length + data)"
      ]
    },
    "AAAA_Record": {
      "description": "AAAA record RDATA - IPv6 address (TYPE=28, CLASS=IN)",
      "sequence": [
        { "name": "address_high", "type": "uint64" },
        { "name": "address_low", "type": "uint64" }
      ]
    }
  },
  "protocol": {
    "name": "DNS Protocol",
    "version": "RFC 1035",
    "description": "Domain Name System (DNS) protocol for resolving domain names to IP addresses and other resource records. DNS uses a distributed database organized in a hierarchical tree structure of domains.",
    "header": "DNSHeader",
    "header_example": {
      "decoded": {
        "id": 4660,
        "qr": 0,
        "opcode": 0,
        "aa": 0,
        "tc": 0,
        "rd": 1,
        "ra": 0,
        "z": 0,
        "rcode": 0,
        "qdcount": 1,
        "ancount": 0,
        "nscount": 0,
        "arcount": 0
      }
    },
    "discriminator": "qr",
    "field_descriptions": {
      "DNSHeader.id": "A 16-bit identifier assigned by the program that generates any kind of query. This identifier is copied into the corresponding reply and can be used by the requester to match up replies to outstanding queries.",
      "DNSHeader.qr": "Query/Response flag - 1 bit that specifies whether this message is a query (0) or a response (1)",
      "DNSHeader.opcode": "Operation code - 4 bits specifying the kind of query. Set by originator, copied into response. 0=standard query (QUERY), 1=inverse query (IQUERY), 2=server status request (STATUS), 3-15=reserved for future use",
      "DNSHeader.aa": "Authoritative Answer - 1 bit valid in responses. Specifies that the responding name server is an authority for the domain name in the question section. Note: AA corresponds to the name matching the query name, or the first owner name in the answer section",
      "DNSHeader.tc": "TrunCation - 1 bit specifying that this message was truncated due to length greater than that permitted on the transmission channel (512 bytes for UDP)",
      "DNSHeader.rd": "Recursion Desired - 1 bit that may be set in a query and is copied into the response. If set, it directs the name server to pursue the query recursively. Recursive query support is optional",
      "DNSHeader.ra": "Recursion Available - 1 bit set or cleared in a response. Denotes whether recursive query support is available in the name server",
      "DNSHeader.z": "Reserved for future use - 3 bits. Must be zero in all queries and responses",
      "DNSHeader.rcode": "Response code - 4 bits set as part of responses. 0=No error, 1=Format error (unable to interpret query), 2=Server failure, 3=Name Error (domain does not exist, only from authoritative server), 4=Not Implemented (query type not supported), 5=Refused (policy reasons), 6-15=reserved",
      "DNSHeader.qdcount": "An unsigned 16-bit integer specifying the number of entries in the question section",
      "DNSHeader.ancount": "An unsigned 16-bit integer specifying the number of resource records in the answer section",
      "DNSHeader.nscount": "An unsigned 16-bit integer specifying the number of name server resource records in the authority records section",
      "DNSHeader.arcount": "An unsigned 16-bit integer specifying the number of resource records in the additional records section",
      "Question.qname": "A domain name represented as a sequence of labels. Each label consists of a length octet followed by that number of octets. The domain name terminates with the zero length octet for the null label of the root. May be an odd number of octets; no padding is used",
      "Question.qtype": "A two-octet code which specifies the type of the query. Values include all TYPE codes plus some more general codes which can match more than one type: 1=A, 2=NS, 5=CNAME, 6=SOA, 12=PTR, 15=MX, 16=TXT, 28=AAAA, 252=AXFR (zone transfer), 255=* (all records)",
      "Question.qclass": "A two-octet code that specifies the class of the query. 1=IN (Internet), 2=CS (CSNET, obsolete), 3=CH (CHAOS), 4=HS (Hesiod), 255=* (any class)",
      "ResourceRecord.name": "An owner name - the domain name to which this resource record pertains. Can be a domain name or a compression pointer (2 bytes starting with bits 11)",
      "ResourceRecord.rtype": "Two octets containing one of the RR TYPE codes. Specifies the meaning of the data in the RDATA field. Common types: 1=A (host address), 2=NS (authoritative name server), 5=CNAME (canonical name), 6=SOA (start of authority), 12=PTR (domain name pointer), 15=MX (mail exchange), 16=TXT (text strings), 28=AAAA (IPv6 address)",
      "ResourceRecord.rclass": "Two octets which specify the class of the data in the RDATA field. 1=IN (Internet), 3=CH (CHAOS), 4=HS (Hesiod)",
      "ResourceRecord.ttl": "A 32-bit unsigned integer that specifies the time interval (in seconds) that the resource record may be cached before it should be discarded. Zero values mean the RR can only be used for the transaction in progress and should not be cached",
      "ResourceRecord.rdlength": "An unsigned 16-bit integer that specifies the length in octets of the RDATA field",
      "A_Record.address": "A 32-bit Internet address (IPv4). Hosts with multiple Internet addresses will have multiple A records",
      "NS_Record.nsdname": "A domain name which specifies a host which should be authoritative for the specified class and domain",
      "CNAME_Record.cname": "A domain name which specifies the canonical or primary name for the owner. The owner name is an alias",
      "SOA_Record.mname": "The name of the primary master name server for the zone",
      "SOA_Record.rname": "The mailbox of the person responsible for this zone",
      "SOA_Record.serial": "The unsigned 32 bit version number of the original copy of the zone. Zone transfers preserve this value",
      "SOA_Record.refresh": "The time interval before the zone should be refreshed",
      "SOA_Record.retry": "The time interval that should elapse before a failed refresh should be retried",
      "SOA_Record.expire": "The upper limit on the time interval that can elapse before the zone is no longer authoritative",
      "SOA_Record.minimum": "The minimum TTL field that should be exported with any RR from this zone",
      "PTR_Record.ptrdname": "A domain-name pointer which points to some other location in the domain name space",
      "MX_Record.preference": "A 16-bit preference value used when multiple mail exchanges exist",
      "MX_Record.exchange": "A domain name which specifies a mail exchange",
      "TXT_Record.data": "Arbitrary text data. Each string is prefixed by a length byte",
      "AAAA_Record.address_high": "High 64 bits of IPv6 address",
      "AAAA_Record.address_low": "Low 64 bits of IPv6 address"
    },
    "notes": [
      "All multi-byte integers use big-endian byte order.",
      "DNS message compression allows repeated domain names to be represented by pointers to previous occurrences.",
      "UDP messages are limited to 512 bytes unless EDNS(0) extensions are used.",
      "Recursive resolvers must randomize the ID field and source port to prevent cache poisoning."
    ],
    "messages": [
      {
        "code": "0x00",
        "name": "DNS_QUERY",
        "direction": "client_to_server",
        "payload_type": "Question",
        "description": "DNS query message sent from a resolver to a name server requesting resolution of a domain name",
        "notes": [
          "**QR bit = 0** in all queries.",
          "**ID field** should be randomly generated to match with responses and prevent spoofing.",
          "**RD bit = 1** requests recursive resolution (server will recursively query other servers if needed).",
          "**QDCOUNT** is typically 1 (one question). **ANCOUNT, NSCOUNT, ARCOUNT** are typically 0 in queries.",
          "**Example:** Query for the IPv4 address (A record) of example.com with class IN"
        ],
        "example": {
          "description": "Standard query for A record of example.com",
          "bytes": [7, 101, 120, 97, 109, 112, 108, 101, 3, 99, 111, 109, 0, 0, 1, 0, 1],
          "decoded": {
            "qname": ["example", "com"],
            "qtype": 1,
            "qclass": 1
          }
        }
      },
      {
        "code": "0x01",
        "name": "DNS_RESPONSE",
        "direction": "server_to_client",
        "payload_type": "ResourceRecord",
        "description": "DNS response message sent from a name server to a resolver containing requested resource records or an error code",
        "notes": [
          "**QR bit = 1** in all responses.",
          "**ID field** is copied from the query to allow matching.",
          "**Question section** is copied from the query.",
          "**Answer section** contains RRs that directly answer the question.",
          "**Authority section** contains NS RRs pointing toward authoritative name servers.",
          "**Additional section** contains RRs that relate to the query but are not strictly answers (e.g., A records for name servers listed in Authority section).",
          "**Message compression** is commonly used in responses. Pointer 0xC00C (bits: 11000000 00001100) refers to offset 12, which is typically the start of the question section's QNAME.",
          "**RCODE field** indicates success (0) or the type of error that occurred.",
          "**AA bit = 1** if the server is authoritative for the domain (not a cached answer).",
          "**TC bit = 1** if the response was truncated due to exceeding 512 bytes over UDP. Client should retry over TCP."
        ],
        "example": {
          "description": "Response with A record for google.com â†’ 142.250.185.46 (uncompressed)",
          "bytes": [6, 103, 111, 111, 103, 108, 101, 3, 99, 111, 109, 0, 0, 1, 0, 1, 0, 1, 81, 128, 0, 4, 142, 250, 185, 46],
          "decoded": {
            "name": ["google", "com"],
            "rtype": 1,
            "rclass": 1,
            "ttl": 86400,
            "rdlength": 4,
            "rdata": [142, 250, 185, 46]
          }
        }
      }
    ]
  }
}
